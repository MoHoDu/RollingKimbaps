## 25.07.15 재료 이미지 변경 및 서빙 버그 픽스

### 회고

- 임시로 만들어둔 재료 이미지를 대체할 이미지 리소스 업데이트 (직접 그림)
- 재료가 그냥 캐릭터 내에 배치되다보니 레시피에 맞는 조합이 이루어진 것인지 알기 힘듦
- 서빙 성공 시에도 특별한 상황에서 입력이 먹히는 경우가 존재함. 이 경우에 서빙 성공은 되지 않고 재료만 사라짐.

### 작업 목표

- 재료 이미지 배치 로직 수정 (캐릭터 및 오더 UI)
  - 현재 모은 재료의 레시피에 대한 프리셋이 있는 경우에만 프리셋 이미지를 세팅
- 서빙 버그 픽스

### 재료 이미지 변경 TODO 리스트

- [x] **IngredientsInKimbapUI에서 재료 세팅 시 레시피와 프리셋 확인**
  - DataContainer.RecipeDatas에서 재료 데이터 배열로 레시피를 가져올 수 있는 메서드 생성
- [x] **프리셋을 세팅하는 메서드 추가**
  - 레시피를 획득했을 때에 프리셋을 가져와 세팅하는 로직을 추가
  - 레시피 혹은 프리셋이 없는 경우 기존 로직으로 연결
- [x] **OrderUI 예외 처리**
  - 캔버스 구조인 OrderUI를 위해 \_presetImage, \_presetSpriteRenderer를 변수로 두고, null이 아닌 컴포넌트의 sprite에 접근
- [x] **통합 테스트**
  - 모든 기능의 통합 동작 테스트
  - 유저 경험 상 얼마나 더 나은지 판단

### 서빙 버그 픽스 TODO 리스트

#### 버그 원인 분석

- **문제점**: `CharacterHandler.InputSubmitKey()` 메서드에서 서빙 성공 여부와 관계없이 `character.ClearIngredients()`가 항상 실행됨
- **영향**: 서빙 실패 시에도 재료가 사라져 사용자 경험 저하
- **핵심 파일**: `Assets/Scripts/InGame/CharacterHandler.cs` (line 88-98)

#### 해결 태스크 계획

- [ ] **Task 1: 서빙 성공/실패 결과 반환 로직 수정**

  - 설명: `OnTryServing()` 메서드에서 서빙 성공 여부를 boolean 값으로 반환하도록 수정
  - 완료 기준: 서빙 성공 시 true, 실패 시 false 반환
  - 우선순위: 높음
  - 관련 파일: `Assets/Scripts/ManagerSystem/InGame/CombinationManager.cs`

- [ ] **Task 2: 입력 처리 로직 개선**

  - 설명: `InputSubmitKey()` 메서드에서 서빙 성공 시에만 재료를 제거하도록 수정
  - 완료 기준: 서빙 성공 시에만 `character.ClearIngredients()` 호출
  - 우선순위: 높음
  - 의존성: Task 1 완료 후
  - 관련 파일: `Assets/Scripts/InGame/CharacterHandler.cs`

- [ ] **Task 3: 연속 입력 방지 로직 추가**

  - 설명: 서빙 처리 중 중복 입력을 방지하는 플래그 추가
  - 완료 기준: 서빙 처리 중 추가 입력 무시
  - 우선순위: 중간
  - 의존성: Task 2 완료 후
  - 관련 파일: `Assets/Scripts/InGame/CharacterHandler.cs`

- [ ] **Task 4: 통합 테스트 및 검증**
  - 설명: 서빙 성공/실패 케이스에 대한 통합 테스트 실행
  - 완료 기준: 모든 시나리오에서 의도한 대로 동작 확인
  - 우선순위: 높음
  - 의존성: Task 3 완료 후

#### 기술적 세부사항

**현재 코드 구조**:

```csharp
public void InputSubmitKey()
{
    if (_gameStatus is not EGameStatus.PLAY) return;
    if (_characterState == ECharacterState.NORMAL)
    {
        _combinationManager.OnTryServing();  // 항상 실행
        character.ClearIngredients();        // 항상 실행 (문제!)
    }
}
```

**개선된 코드 구조**:

```csharp
public void InputSubmitKey()
{
    if (_gameStatus is not EGameStatus.PLAY) return;
    if (_characterState == ECharacterState.NORMAL)
    {
        bool servingSuccess = _combinationManager.OnTryServing();
        if (servingSuccess)
        {
            character.ClearIngredients();  // 성공 시에만 실행
        }
    }
}
```

#### 검증 기준

- 서빙 성공 시: 재료가 제거되고 보상이 지급됨
- 서빙 실패 시: 재료가 유지되고 실패 이펙트만 표시됨
- 연속 입력 시: 중복 처리 방지됨
